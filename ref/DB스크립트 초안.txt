CREATE TABLE tb_chat_session (
	session_id	BIGINT	NOT NULL,
	user_id	BIGINT	NOT NULL	COMMENT '사용자 고유 식별자',
	status	ENUM('open', 'closed', 'waiting', 'assigned')	NOT NULL	DEFAULT 'closed',
	is_ai_only	TINYINT(1)	NOT NULL	DEFAULT 1,
	create_time	TIMESTAMP	NULL	DEFAULT current_timestamp,
	closed_time	TIMESTAMP	NULL
);

CREATE TABLE tb_login_history (
	history_id	BIGINT	NOT NULL	COMMENT '로그인 기록 고유 식별자',
	user_id	BIGINT	NOT NULL	COMMENT '사용자 FK',
	login_ip	VARCHAR(45)	NOT NULL	COMMENT '로그인 IP',
	login_at	TIMESTAMP	NOT NULL	DEFAULT current_timestamp	COMMENT '로그인 시각',
	user_agent	VARCHAR(512)	NOT NULL	COMMENT '브라우저, OS, 디바이스 정보',
	login_status	ENUM('success', 'failed', 'blocked')	NOT NULL	COMMENT '로그인 상태',
	fail_reason	VARCHAR(100)	NULL	COMMENT '로그인 실패 사유'
);

CREATE TABLE tb_faq (
	faq_id	BIGINT	NOT NULL,
	intent_name	VARCHAR(100)	NULL	COMMENT '숙소추천, 지원금문의 같은 키워드',
	example_phrases	TEXT	NULL	COMMENT '의도학습위한 예시문장',
	create_time	TIMESTAMP	NULL	DEFAULT current_timestamp
);

CREATE TABLE tb_notification (
	noti_id	BIGINT	NOT NULL,
	user_id	BIGINT	NOT NULL	COMMENT '사용자 고유 식별자',
	noti_title	VARCHAR(200)	NULL,
	noti_msg	TEXT	NULL,
	noti_type	ENUM('reservation', 'promotion', 'system', 'etc')	NULL,
	sent_time	TIMESTAMP	NULL	DEFAULT current_timestamp,
	status	ENUM('success', 'failed')	NULL
);

CREATE TABLE tb_chat_message (
	chat_id	BIGINT	NOT NULL,
	session_id	BIGINT	NOT NULL,
	user_id	BIGINT	NOT NULL	COMMENT '사용자 고유 식별자',
	faq_id	BIGINT	NOT NULL,
	sender_role	ENUM('user', 'admin', 'bot')	NOT NULL,
	msg_text	TEXT	NULL	COMMENT '메시지 내용',
	send_time	TIMESTAMP	NULL	DEFAULT current_timestamp
);

CREATE TABLE tb_project (
	program_id	BIGINT	NOT NULL,
	searchPG_id	BIGINT	NOT NULL,
	program_title	VARCHAR(100)	NOT NULL,
	program_info	TEXT	NOT NULL,
	program_checkin	TIMESTAMP	NULL,
	program_checkout	TIMESTAMP	NULL,
	program_people	INT	NULL,
	program_price	INT	NULL
);

CREATE TABLE tb_stay (
	stay_id	BIGINT	NOT NULL,
	program_id	BIGINT	NOT NULL,
	stay_name	VARCHAR(100)	NOT NULL,
	stay_code	VARCHAR(100)	NULL	COMMENT '지역구분코드',
	stay_address	VARCHAR(1000)	NULL	COMMENT '숙소 주소',
	stay_phone	VARCHAR(15)	NULL	COMMENT '전화번호'
);

CREATE TABLE tb_user_social_login (
	social_id	BIGINT	NOT NULL	COMMENT '소셜 로그인 고유 식별자',
	user_id	BIGINT	NOT NULL	COMMENT '사용자 FK',
	provider	ENUM('kakao', 'naver')	NULL	COMMENT '소셜 연동 플랫폼',
	provider_user_id	VARCHAR(255)	NULL	COMMENT '소셜 연동 고유 ID',
	email	VARCHAR(100)	NULL	COMMENT '플랫폼에서 받은 이메일',
	created_at	TIMESTAMP	NULL	DEFAULT current_timestamp	COMMENT '연동 날짜'
);


CREATE TABLE tb_attraction (
	attraction_id	BIGINT	NOT NULL,
	attraction_name	VARCHAR(100)	NULL,
	attraction_url	VARCHAR(255)	NULL,
	attraction_address	VARCHAR(255)	NULL,
	attraction_phone	VARCHAR(15)	NULL
);

CREATE TABLE tb_review (
	review_id	BIGINT	NOT NULL,
	program_id	BIGINT	NOT NULL,
	user_id	BIGINT	NOT NULL	COMMENT '사용자 고유 식별자',
	review_title	VARCHAR(100)	NOT NULL,
	review_content	TEXT	NULL,
	review_date	TIMESTAMP	NULL,
	review_point	INT	NULL	DEFAULT 0	COMMENT '0~5'
);

CREATE TABLE tb_photo_mapping (
	photomapping_id	BIGINT	NOT NULL,
	photo_id	BIGINT	NOT NULL,
	attraction_id	BIGINT	NULL,
	office_id	BIGINT	NULL,
	stay_id	BIGINT	NULL,
	target_type	ENUM('stay', 'office', 'attraction')	NULL,
	target_id	BIGINT	NULL	COMMENT '대상테이블의 PK',
	is_thumbnail	TINYINT(1)	NULL	DEFAULT 0	COMMENT '썸네일 여부'
);

CREATE TABLE tb_search_project (
	searchPG_id	BIGINT	NOT NULL,
	searchPoint	INT	NULL	COMMENT '0~100'
);

CREATE TABLE tb_users (
	user_id	BIGINT	NOT NULL	COMMENT '사용자 고유 식별자',
	email	VARCHAR(100)	NOT NULL	COMMENT '소속 회사 이메일(로그인 아이디)',
	user_pwd	VARCHAR(255)	NOT NULL	COMMENT '암호화하여 저장',
	user_name	VARCHAR(100)	NOT NULL,
	phone	VARCHAR(20)	NULL,
	birth	DATE	NOT NULL,
	company	VARCHAR(30)	NOT NULL,
	updated_at	TIMESTAMP	NULL	DEFAULT current_timestamp,
	user_role	ENUM('user', 'admin')	NOT NULL
);

CREATE TABLE tb_reservation_pdf (
	pdf_id	BIGINT	NOT NULL	COMMENT 'pdf 생성 고유 식별자',
	reservation_id	BIGINT	NOT NULL	COMMENT '예약 고유 식별자',
	confirmation_date	TIMESTAMP	NOT NULL	DEFAULT current_timestamp	COMMENT '예약 확정서 발행 일자',
	pdf_file_path	VARCHAR(500)	NOT NULL	COMMENT 'PDF 파일 저장 경로 (S3 서버)',
	confirm_number	VARCHAR(15)	NOT NULL	COMMENT '문서번호 (RC-2025-0001)'
);

CREATE TABLE tb_payments (
	payment_id	BIGINT	NOT NULL	COMMENT '결제 고유 식별자',
	reservation_id	BIGINT	NOT NULL	COMMENT '예약 FK',
	order_id	VARCHAR(100)	NULL	COMMENT '토스 API 주문 번호',
	payment_key	VARCHAR(200)	NULL	COMMENT '토스 API 고유 결제키',
	amount	INT	NOT NULL	COMMENT '결제 금액',
	payment_status	ENUM('ready', 'paid', 'cancelled', 'failed')	NOT NULL	COMMENT '결제 상태',
	payment_method	VARCHAR(50)	NOT NULL	COMMENT '결제 방법',
	approved_at	TIMESTAMP	NULL	COMMENT '결제 승인시각',
	created_at	TIMESTAMP	NULL	DEFAULT current_timestamp	COMMENT '결제 시각'
);

CREATE TABLE tb_refund (
	refund_id	BIGINT	NOT NULL	COMMENT '결제 취소 고유 식별자',
	payment_id	BIGINT	NOT NULL	COMMENT '결제 FK',
	refund_amount	INT	NOT NULL	COMMENT '취소 금액',
	refund_reason	VARCHAR(200)	NULL	COMMENT '취소 사유',
	cancel_key	VARCHAR(200)	NULL	COMMENT '토스 API 연관 컬럼',
	refund_status	ENUM('pending', 'completed', 'failed')	NOT NULL	DEFAULT 'pending'	COMMENT '취소 상태',
	requested_by	ENUM('user', 'admin')	NULL	DEFAULT 'user'	COMMENT '취소 요청자',
	refunded_at	TIMESTAMP	NULL	COMMENT '취소 완료시각',
	created_at	TIMESTAMP	NOT NULL	DEFAULT current_timestamp	COMMENT '취소 요청시각'
);

CREATE TABLE tb_inquiry (
	inquiry_id	BIGINT	NOT NULL,
	session_id	BIGINT	NOT NULL,
	user_id	BIGINT	NOT NULL	COMMENT '사용자 고유 식별자',
	category	ENUM('stay,' 'region', 'subsidy', 'schedule', 'etc')	NULL,
	inquiry_detail	TEXT	NULL,
	inquiry_time	TIMESTAMP	NULL	DEFAULT current_timestamp
);

CREATE TABLE tb_reservation_modify (
	modify_request_id	BIGINT	NOT NULL	COMMENT 'PK, 수정요청 고유 식별자',
	reservation_id	BIGINT	NOT NULL	COMMENT '예약 고유 식별자',
	user_id	BIGINT	NOT NULL	COMMENT '사용자 고유 식별자',
	after_data	JSON	NOT NULL	COMMENT '수정 요청 데이터 (변경사항 JSON)',
	status	ENUM('pending', 'approved', 'rejected')	NOT NULL	DEFAULT 'pending'	COMMENT '대기, 승인, 거절',
	reject_reason	VARCHAR(225)	NULL	COMMENT '관리자 승인 거절 사유',
	requested_at	TIMESTAMP	NOT NULL	DEFAULT current_timestamp	COMMENT '요청 시각',
	processed_at	TIMESTAMP	NULL	COMMENT '승인/거절 처리 시각'
);

CREATE TABLE tb_refresh_tokens (
	token_id	BIGINT	NOT NULL	COMMENT '토큰 고유 식별자',
	user_id	BIGINT	NOT NULL	COMMENT '사용자 FK',
	refresh_token	VARCHAR(500)	NOT NULL	COMMENT '토큰 정보',
	created_at	TIMESTAMP	NULL	DEFAULT current_timestamp	COMMENT '토큰 생성일자',
	expires_at	TIMESTAMP	NOT NULL	COMMENT '토큰 만료일자'
);

CREATE TABLE tb_office (
	office_id	BIGINT	NOT NULL,
	program_id	BIGINT	NOT NULL,
	office_name	VARCHAR(100)	NOT NULL,
	office_code	VARCHAR(100)	NULL,
	office_address	VARCHAR(1000)	NULL,
	office_phone	VARCHAR(15)	NULL
);

CREATE TABLE tb_reservation (
	reservation_id	BIGINT	NOT NULL	COMMENT '예약 고유 식별자',
	user_id	BIGINT	NOT NULL	COMMENT '사용자 고유 식별자',
	program_id	BIGINT	NOT NULL	COMMENT '프로젝트 테이블 참조',
	reservation_no	VARCHAR(20)	NOT NULL	COMMENT '예약번호(YYYYMMDD-00000001)',
	start_date	DATE	NOT NULL	COMMENT '예약 시작 날짜',
	end_date	DATE	NOT NULL	COMMENT '예약 종료 날짜',
	status	ENUM('waiting', 'confirm', 'cancel')	NOT NULL	DEFAULT 'waiting'	COMMENT '예약 상태(대기/확정/취소)',
	created_date	TIMESTAMP	NOT NULL	DEFAULT current_timestamp	COMMENT '예약 생성일',
	updated_date	TIMESTAMP	NULL	DEFAULT current_timestamp	COMMENT '예약 수정일',
	total	BIGINT	NOT NULL	COMMENT '워케이션 총금액'
);

CREATE TABLE tb_photo (
	photo_id	BIGINT	NOT NULL,
	photo_url	VARCHAR(255)	NULL,
	photo_uuid	VARCHAR(255)	NULL,
	photo_name	VARCHAR(255)	NULL,
	photo_type	VARCHAR(10)	NULL,
	photo_size	BIGINT	NULL,
	photo_createTime	TIMESTAMP	NULL
);

CREATE TABLE tb_payment_logs (
	log_id	BIGINT	NOT NULL	COMMENT '결제로그 고유 식별자',
	payment_id	BIGINT	NOT NULL	COMMENT '결제 FK',
	response_data	JSON	NULL	COMMENT '토스 API 응답값',
	event_type	ENUM('request', 'response', 'callback', 'fail')	NOT NULL	COMMENT '로그 분류',
	http_status	INT	NULL	COMMENT '상태 코드',
	logged_at	TIMESTAMP	NOT NULL	DEFAULT current_timestamp	COMMENT '로그 발생시각'
);

CREATE TABLE tb_room (
	room_id	BIGINT	NOT NULL,
	stay_id	BIGINT	NOT NULL,
	program_id	BIGINT	NOT NULL,
	room_no	INT	NULL,
	room_people	INT	NULL,
	room_service	VARCHAR(1000)	NULL
);

CREATE TABLE tb_search (
	search_id	BIGINT	NOT NULL,
	user_id	BIGINT	NOT NULL,
	searchPG_id	BIGINT	NOT NULL,
	search_time	TIMESTAMP	NULL	DEFAULT current_timestamp
);

